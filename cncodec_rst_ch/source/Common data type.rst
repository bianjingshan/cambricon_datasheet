.. _topics-Common data type:

公用数据类型
=============================

本章介绍CNCodec公用数据类型。

CN_HANDLE_VDEC
-----------------------

解码器句柄，64位无符号整型。

CN_HANDLE_VENC
------------------------

编码器句柄，64位无符号整型。

CN_VIDEO_CODEC_TYPE_E
-------------------------

压缩数据格式

======================== ============================================== 
参数名称                  描述           
======================== ============================================== 
CN_VIDEL_CODEC_MPEG4     MPEG4          
CN_VIDEL_CODEC_H264      H264           
CN_VIDEL_CODEC_HEVC      HEVC           
CN_VIDEL_CODEC_JPEG      JPEG           
CN_VIDEO_CODEC_MJPEG     MJPEG          
======================== ============================================== 

CN_VIDEO_MODE_E
--------------------------

码流发送模式。

======================== ============================================== 
参数名称                  描述           
======================== ============================================== 
CN_VIDEO_MODE_FRAME      按帧发送
CN_VIDEO_MODE_STREAM     按流发送
======================== ============================================== 

CN_PIXEL_FORMAT_E
--------------------------

像素格式

======================== ==============================================
参数名称                    描述       
======================== ==============================================
CN_PIXEL_FORMAT_YUV420SP   YUV420 SemiPlanar 
CN_PIXEL_FORMAT_RGB24      RGB24             
CN_PIXEL_FORMAT_BGR24      BGR24             
======================== ==============================================

CN_VIDEO_DIE_MODE_E
--------------------------

De-interlace 模式。

======================== ==============================================
参数名称                   描述                   
======================== ==============================================
CN_VIDEO_DIE_MODE_NODIE   强制不做De-interlace  
CN_VIDEO_DIE_MODE_AUTO    自适应是否做De-interlace   
CN_VIDEO_DIE_MODE_DIE     强制做De-interlace      
======================== ==============================================

CN_VIDEO_IMAGE_INFO_S
--------------------------

解码输出图片信息。

======================== ============================================== 
参数名称                  描述                                
======================== ============================================== 
enPixelFormat            像素格式                               
u32FrameSize             帧大小                                
u32Height                图片高度                               
u32Width                 图片宽度                                
u64Pts                   PTS（暂不支持）                     
u32Stride                图片 *Stride*                           
u64PhyAddr               图片物理地址                     
u64VirAddr               图片虚拟地址                      
u64FrameIndex            解码帧号                         
u64VideoIndex            显示帧号（暂不支持）    
u32BufIndex              当前帧所在的MLU缓存index                                    
u64TransferUs            当前帧解码图像从codec到输出内存的传输延时（微秒）       
u64DecodeDelayUs         当前帧codec内部解码延时（微秒）                          
u64SendCallbackDelayUs   当前帧从CN_MPI_VDEC_Send发送到回调的延时（微秒）    
u64InputUs               当前帧压缩数据从host传输到device的延时（微秒）  
======================== ============================================== 

CN_RECT_S
--------------------------

位置坐标

======================== ==============================================
参数名称                  描述                                   
======================== ==============================================
u32X                     坐标X，2像素对齐                               
u32Y                     坐标Y，2像素对齐                               
u32Width                 坐标width，4像素对齐                           
u32Height                坐标height，4像素对齐                          
======================== ==============================================

CN_RECT_COORDINATE_E
--------------------------

坐标模式

相对坐标模式中，CN_RECT_S的成员的取值范围是[0,1000]，每个单位表示图像宽度或高度的1/1000

======================== ==============================================
参数名称                  描述                                
======================== ==============================================
CN_RECT_RATIO_COOR       相对坐标          
CN_RECT_ABS_COOR         绝对坐标                       
======================== ==============================================

CN_VIDEO_CROP_ATTR_S
--------------------------

图片裁剪配置

======================== ==============================================
参数名称                  描述                                
======================== ==============================================
bEnable                  是否使能图片裁剪           
enCropCoordinate         裁剪区域的坐标模式       
stCropRect               裁剪区域的坐标            
======================== ==============================================

CN_VIDEO_FRAME_RATE_S
--------------------------

帧率控制，CNCodec内部有主动丢帧机制，当输入帧率过高超出解码能力时应用程序可通过帧率控制实现主动丢帧。帧率控制参数用于设置主动丢帧机制。

s32SrcFrmRate>s32DstFrmRate时主动丢帧
    丢帧率 = 1 - (s32SrcFrmRate / s32DstFrmRate)

s32SrcFrmRate == s32DstFrmRate 时不主动丢帧

======================== ==============================================
参数名称                  描述                                
======================== ==============================================
bEnable                  是否使能帧率控制              
s32SrcFrmRate            输入帧率                        
s32DstFrmRate            输出帧率                       
======================== ==============================================

CN_VIDEO_PP_ATTR_S
--------------------------

图片后处理属性

======================== ==============================================
参数名称                  描述                                
======================== ==============================================
stFrameRate              帧率控制属性                                    
stCropAttr               图片裁剪属性                                        
enDieMode                De-interlace去隔行模式                                   
bIeEn                    保留，必须设置为0                                      
bDciEn                   是否使能动态对比度调节                   
bNrEn                    是否使能降噪                               
bHistEn                  保留，必须设置为0                                      
bEsEn                    保留，必须设置为0                                      
bSpEn                    是否使能图像锐化                              
u32Constrast             动态对比度调节强度，默认值32  
u32DieStrength           保留，必须设置为0                                      
u32IeStrength            保留，必须设置为0                                      
u32SfStrength            空域去噪强度0-2047，默认值128    
u32TfStrength            保留，必须设置为0                                      
u32CfStrength            色域去噪强度0-255，默认值8    
u32CTfStrength           保留，必须设置为0                                      
u32CvbsStrength          保留，必须设置为0                                      
u32DeMotionBlurring      保留，必须设置为0                                      
u32SpStrength            图像锐化强度0-100，默认值32       
======================== ==============================================

CN_MLU_P2P_BUFFER_S
--------------------------

输出buffer信息，用于接收输出数据

======================== ==============================================
参数名称                  描述                                
======================== ==============================================
addr                     输出buffer内存虚拟地址    
len                      输出buffer长度                   
======================== ==============================================

CN_BUFFER_TYPE_E
--------------------------

输出buffer类型

======================== ==============================================
参数名称                  描述                                
======================== ==============================================
CN_MLU_BUFFER            MLU buffer           
CN_CPU_BUFFER            CPU buffer           
======================== ==============================================

CN_MLU_P2P_ATTR_S
--------------------------

输出buffer配置信息

======================== ==============================================
参数名称                  描述                                
======================== ==============================================
buffer_num               输出buffer数量                           
buffer_type              输出buffer类型, MLU / CPU                   
\*p_buffers              输出buffer信息结构体指针  
======================== ==============================================

CN_VIDEO_CREATE_ATTR_S
--------------------------

解码器通道属性

======================== ==============================================
参数名称                  描述                                
======================== ==============================================
u32VdecDeviceID          板卡设备号，0-(device num-1)，每个设备号指向一个板卡                                         
enInputVideoCodec        解码数据格式                               
enVideoMode              码流发送方式
u32MaxWidth              最大支持的分辨率（宽度）2像素对齐
u32MaxHeight             最大支持的分辨率（高度）2像素对齐
u32TargetWidth           输出分辨率（宽度）2像素对齐
u32TargetHeight          输出分辨率（高度）2像素对齐
u32TargetWidthSubstream  子码流输出分辨率（宽度）2像素对齐，0=关闭子码流输出
u32TargetHeightSubstream 子码流输出分辨率（高度）2像素对齐，0=关闭子码流输出
u32MaxFrameSize          最大ES帧大小（暂不支持）
u32EsBufCount            ES流缓冲器个数（暂不支持）
u32ImageBufCount         图片缓冲区格式（暂不支持）
enOutputPixelFormat      输出像素格式                                      
stPostProcessAttr        图片后处理属性
u64UserData              回调函数用户上下文
pImageCallBack           解码图片回调函数指针
mluP2pAttr               输出 buffer 信息
======================== ==============================================

CN_VIDEO_PIC_PARAM_S
--------------------------

输入数据信息

======================== ==============================================
参数名称                  描述                                
======================== ==============================================
nBitStreamDataLen        数据长度             
nBitStreamData           数据地址            
u64FrameIndex            帧号
u32Width                 图像宽度（仅对编码通道有效）
u32Height                图像高度（仅对编码通道有效）
======================== ==============================================

CN_VDEC_DEVICE_CAPABILITY_S
-------------------------------

单个device状态信息

======================== ==============================================
参数名称                  描述                                
======================== ==============================================
u32DeviceID              device ID                                                
u32MluIndex              mlu index，用于申请mlu内存时向cnrt接口提供device index
u32FreeChannels          空闲解码通道数
u32UsedChannels          占用解码通道数
======================== ==============================================

CN_VDEC_CAPABILITY_S
-------------------------------

所有 device 状态信息

======================== ==============================================
参数名称                  描述                                
======================== ==============================================
u32VdecDeviceNum         device 数量                                  
VdecDeviceList[]         所有device信息
======================== ==============================================

CN_VDEC_IMAGE_CALLBACK
-------------------------------

解码图片回调函数:

CN_VOID (\*CN_VDEC_IMAGE_CALLBACK)(CN_VIDEO_IMAGE_INFO_S \*pImageOutput, CN_U64 u64UserData);

======================== ==============================================
参数名称                  描述                                
======================== ==============================================
pImageOutput             输出图片信息
u64UserData              用户上下文
======================== ==============================================

CN_LOG_LEVEL
-------------------------------

日志级别，枚举类型

======================== ==============================================
参数名称                  描述                                
======================== ==============================================
CN_LOG_NONE              无级别          
CN_LOG_ERR               错误日志
CN_LOG_WARN              警告日志
CN_LOG_INFO              信息日志
CN_LOG_DEBUG             debug日志
======================== ==============================================

CN_LOG_CALLBACK
------------------------------

日志输出回调函数:

CN_VOID (\*CN_LOG_CALLBACK)(CN_LOG_LEVEL level, const char \*msg);

======================== ==============================================
参数名称                  描述                                
======================== ==============================================
level                    日志级别
msg                      日志信息
======================== ==============================================

CNResult
------------------------------

解码图片回调函数

=================================== ======= ==============================================
参数名称                             值      描述                                
=================================== ======= ==============================================
CN_SUCCESS                          0       成功                                    
CN_ERROR_INVALID_VALUE              1       参数非法
CN_ERROR_OUT_OF_MEMORY              2       内存不足
CN_ERROR_NOT_INITIALIZED            3       非初始化
CN_ERROR_DEINITHALIZED              4       已经销毁
CN_ERROR_PROFILER_DISABLED          5       Profiler被禁用
CN_ERROR_PROFILER_NOT_INITIALIZED   6       Profiler未初始化
CN_ERROR_ALREADY_STARTED            7       已经开启
CN_ERROR_ALREADY_STOPPED            8       已经停止
CN_ERROR_OS_CALL                    9       OS系统调用失败
CN_ERROR_INVALID_FORMAT             10      不支持的编码格式
CN_ERROR_NO_RESOURCE                11      资源不足
CN_ERROR_NO_DEVICE                  100     设备不存在
CN_ERROR_INVALID_DEVICE             101     非法设备
CN_ERROR_INVALID_IMAGE              200     非法图片
CN_ERROR_INVALID_CONTEXT            201     非法上下文
CN_ERROR_INVALID_DATA               202     非法数据
CN_ERROR_INVALID_SOURCE             300     输入源非法
CN_ERROR_FILE_NOT_FOUND             301     文件不存在
CN_ERROR_INVALID_HANDLE             400     非法句柄
CN_ERROR_NOT_FOUND                  500     没有找到
CN_ERROR_NOT_READY                  600     没有就位
CN_ERROR_LAUNCH_FAILED              700     开启失败
CN_ERROR_LAUNCH_OUT_OF_RESOURCES    701     开启过程中内存分配失败
CN_ERROR_LAUNCH_TIMEOUT             702     开启超时失败
CN_ERROR_UNKNOWN                    999     位置错误
CN_ERROR_SYSCALL                    1000    SYS系统调用失败
=================================== ======= ==============================================

CN_VENC_RC_t
------------------------------

编码器码率控制模式

======================== ==============================================
参数名称                  描述                                
======================== ==============================================
CBR                      固定比特率                   
VBR                      可变比特率                
======================== ==============================================

CN_VENC_ATTR_H264_CBR_S
------------------------------

编码器CBR码率控制参数

======================== ==============================================
参数名称                  描述                                
======================== ==============================================
u32Gop                   H.264 Gop值，范围：[1, 65536]
u32StatTime              CBR 码率统计时间，单位：秒，范围：[1, 60]
u32SrcFrmRate            VI输入帧率，值要求比fr32DstFrmRate大
fr32DstFrmRate           编码器输出帧率，单位:fps
u32BitRate               平均bitrate，单位：kbps。范围：[2, 102400]
u32FluctuateLevel        最大码率相对平均码率的波动等级，范围：[0, 5], 推荐使用波动等级0
======================== ==============================================

CN_VENC_ATTR_H264_VBR_S
------------------------------

编码器VBR码率控制参数

======================== ==============================================
参数名称                  描述                                
======================== ==============================================
u32Gop                   H.264 Gop值，范围：[1, 65536]
u32StatTime              VBR 码率统计时间，单位：秒，范围：[1, 60]
u32SrcFrmRate            VI输入帧率，值要求比fr32DstFrmRate大
fr32DstFrmRate           编码器输出帧率，单位:fps  
u32MaxBitRate            最大bitrate，单位：kbps。范围：[2, 102400]
u32MaxQp                 编码器支持图像最大QP, [u32MinQp,51]
u32MinQp                 编码器支持图像最小QP, [0,51]
======================== ==============================================

CN_VENC_CREATE_ATTR_S
------------------------------

编码器通道属性

======================== ==============================================
参数名称                  描述                                
======================== ==============================================
u32VencDeviceID          板卡设备号，0-(device num-1)，每个设备号指向一个板卡
VideoCodecType           编码数据格式，支持MJPEG、H264、JPEG
rate_control_mode        码率控制模式
u32MaxWidth              编码图像最大宽度
u32MaxHeight             编码图像最大高度
pixel_format             输入像素格式                 
u32TargetWidth           输出图像宽度，2像素对齐
u32TargetHeight          输出图像高度，2像素对齐
H264CBR                  CBR码率控制参数
H264VBR                  VBR码率控制参数
bcolor2gray              灰度编码设置（彩色图像转换为灰度图像再进行编码）
encode_crop              裁剪编码设置
mluP2pAttr               输出内存设置
pEncodeCallBack          编码图片回调函数指针
pu64UserData             回调函数用户上下文
======================== ==============================================

CN_VENC_DEVICE_CAPABILITY_S
------------------------------

单个device编码通道信息

======================== ==============================================
参数名称                  描述                                
======================== ==============================================
u32DeviceID              device ID                                                
u32MluIndex              mlu index
u32FreeChannels          空闲编码通道数
u32UsedChannels          占用编码通道数
======================== ==============================================

CN_VENC_CAPABILITY_S
------------------------------

所有 device 编码通道状态信息

======================== ==============================================
参数名称                  描述                                
======================== ==============================================
u32VdecDeviceNum         device 数量                                  
VdecDeviceList[]         所有device信息
======================== ==============================================